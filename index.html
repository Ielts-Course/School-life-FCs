<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<title>è‹±æ±‰è¯æ±‡é—ªå¡</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
    :root { --card-w: 88vw; --card-max-w: 520px; --card-h: 60vh; --card-max-h: 600px; --radius: 14px; --shadow: 0 8px 24px rgba(0,0,0,0.08); --brand: #0f766e; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "PingFang SC","Noto Sans SC","Microsoft YaHei", sans-serif; margin: 0; padding: 0; min-height: 100vh; background: #f7faf9; display: flex; flex-direction: column; align-items: center; }

    .site-header { display:flex; align-items:center; gap:14px; margin:20px 16px 6px; flex-direction: row; }
    .site-header img { height:72px; width:auto; }
    .site-title { font-weight: 800; font-size: 1.25rem; color:#0b3c39; text-align: center; }
    .site-instruction { margin: 0 16px 14px; color:#334; text-align:center; }

    .card-container { position: relative; width: var(--card-w); max-width: var(--card-max-w); height: var(--card-h); max-height: var(--card-max-h); perspective: 1000px; margin-bottom: 12px; }
    .card { position: absolute; inset: 0; transform-style: preserve-3d; transition: transform .6s ease; z-index:1; }
    .front, .back { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: var(--radius); background: #fff; border:1px solid #e8ebe9; box-shadow: var(--shadow); padding: 28px; backface-visibility: hidden; }
    .back { transform: rotateY(180deg); }
    .card.flipped { transform: rotateY(180deg); }
    body.overlay-open #card { pointer-events: none; }

    .word { font-size: clamp(2.2rem, 8vw, 3.2rem); font-weight: 800; color:#0b3c39; text-align:center; line-height:1.05; }
    .phon { margin-top: 10px; font-size: clamp(1rem, 3.5vw, 1.4rem); color:#6b7c7a; font-weight: 500; letter-spacing:.3px; }
    .translation-zh { font-size: clamp(1.4rem, 4.5vw, 1.8rem); color:#0b3c39; font-weight: 700; text-align:center; }
    .example { margin-top: 14px; width:100%; max-width: 520px; text-align:center; }
    .ex-en { font-size: 1.05rem; color:#1f2937; margin-bottom: 6px; text-align:center; }
    .ex-zh { font-size: 1.05rem; color:#374151; text-align:center; }
    .highlight { font-weight: 800; color: var(--brand); }

    .audio-front, .audio-back { margin-top: 16px; font-size: 1.4rem; cursor:pointer; user-select:none; }
    .buttons-container { display:flex; gap:10px; width: var(--card-w); max-width: var(--card-max-w); margin-bottom: 16px; }
    .btn { flex:1; padding: 12px; border:none; border-radius: 10px; font-size:1rem; cursor:pointer; box-shadow: 0 2px 4px rgba(0,0,0,.06); }
    .know { background:#c7f9cc; }
    .practice { background:#ffddd2; }

    .nav { display:flex; justify-content:space-between; width:var(--card-w); max-width: var(--card-max-w); margin-bottom: 16px; }
    .nav button { font-size:2rem; background:none; border:none; cursor:pointer; }

    .hidden { display:none; }

    #congratsMsg { position:absolute; inset:0; background:#fff; border-radius:var(--radius); box-shadow: var(--shadow); padding: 20px; z-index:9999; }
    #congratsMsg:not(.hidden) { display:flex; flex-direction:column; align-items:center; justify-content:center; gap: 10px; }
    #congratsMsg input { padding:10px; border:1px solid #e5e7eb; border-radius:10px; width: 100%; max-width: 320px; }
    #congratsActions { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    #saveImgBtn { background:#dbeafe; }
    #reviewAll { background:#e5e7eb; }

    footer { margin-top:auto; font-size:.85rem; color:#6b7280; text-align:center; padding: 18px 10px; width:100%; }

    @media print {
      body { background: #fff; }
      .site-header, .site-instruction, .card-container, .buttons-container, .nav, #reviewControls, footer, #congratsMsg { display: none !important; }
      #pdfReport { display: block !important; }
    }
    #pdfReport { display:none; padding: 24px; max-width: 980px; margin: 0 auto; font-size: 14px; color:#111827; }
    #pdfReport h1 { font-size: 1.5rem; margin: 0 0 8px; }
    #pdfReport h2 { font-size: 1.2rem; margin: 18px 0 8px; }
    #pdfReport table { width:100%; border-collapse: collapse; margin-top: 8px; }
    #pdfReport th, #pdfReport td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; }
    #pdfReport .muted { color:#6b7280; }
    #pdfReport .score-row { font-size: 1.3rem; font-weight: 800; color: var(--brand); }
  
.site-title { text-align: left; }

.site-header-content { display: flex; flex-direction: column; }
.site-title { text-align: left; }
</style>
</head>
<body>
<div class="site-header">
<img alt="BFSU Logo" src="LOGO.png"/>

<div class="site-header-content"><div class="site-title" id="siteTitle">è¯æ±‡é—ªå¡</div></div></div><p class="site-instruction" id="siteInstr">ç‚¹å‡»å¡ç‰‡ä»¥ç¿»è½¬ã€‚ç‚¹å‡»éŸ³é¢‘å›¾æ ‡ğŸ”Šå¯æ”¶å¬å•è¯æˆ–å¥å­ã€‚</p>
<div class="card-container">
<div class="card" id="card">
<div aria-label="ç¿»è½¬å¡ç‰‡" class="front" role="button">
<div class="word" id="frontWord"></div>
<div class="phon" id="frontPhon"></div>
<button aria-label="æ’­æ”¾å•è¯éŸ³é¢‘" class="audio-front" id="audioFront" title="æ’­æ”¾å•è¯éŸ³é¢‘">ğŸ”Š</button>
</div>
<div aria-label="ç¿»è½¬å¡ç‰‡" class="back" role="button">
<div class="translation-zh" id="backTransZh"></div>
<div class="example">
<div class="ex-en" id="exEn"></div>
<div class="ex-zh" id="exZh"></div>
</div>
<button aria-label="æ’­æ”¾ä¾‹å¥éŸ³é¢‘" class="audio-back" id="audioBack" title="æ’­æ”¾ä¾‹å¥éŸ³é¢‘">ğŸ”Š</button>
</div>
</div>
<div class="hidden" id="congratsMsg">
<h2>å¤ªæ£’äº†ï¼ğŸ‰</h2>
<input id="studentId" placeholder="å§“å / å­¦å·ï¼ˆå¯é€‰ï¼‰"/>
<div class="muted" id="congratsSummary"></div>
<div id="congratsActions">
<button class="btn" id="saveImgBtn">ä¿å­˜ä¸ºå›¾ç‰‡</button>
<button class="btn" id="reviewAll">å¤ä¹ æ‰€æœ‰å•è¯</button>
</div>
</div>
</div>
<div class="buttons-container">
<button class="btn know" id="knowBtn">å·²æŒæ¡</button>
<button class="btn practice" id="practiceBtn">éœ€è¦ç»ƒä¹ </button>
</div>
<div class="nav">
<button aria-label="ä¸Šä¸€å¼ " id="prevBtn">â†</button>
<button aria-label="ä¸‹ä¸€å¼ " id="nextBtn">â†’</button>
</div>
<div class="hidden" id="reviewControls">
<button class="btn" id="reviewPractice">å¤ä¹ â€œéœ€è¦ç»ƒä¹ â€</button>
</div>
<!-- æŠ¥å‘Šï¼ˆç”¨äºå¯¼å‡ºå›¾ç‰‡ï¼‰ -->
<section id="pdfReport">
<h1>å­¦ä¹ è¡¨ç°æŠ¥å‘Š</h1>
<div id="reportMeta"></div>
<h2>æ‘˜è¦</h2>
<table>
<tbody id="summaryTable"></tbody>
</table>
<p class="muted">æ­¤æŠ¥å‘Šç”±å‰ç«¯é¡µé¢æœ¬åœ°ç”Ÿæˆï¼Œå¯æ”¾å¿ƒä¿å­˜å¹¶å‘é€ç»™è€å¸ˆã€‚</p>
</section>
<footer>Â©2025 Dr. Carlos Cardenas â€¢ æ•™è‚²ç®¡ç†å­¦åšå£«</footer>
<script>
    // ====== è¯è¡¨æ•°æ®ï¼ˆåŠ¨æ€ï¼‰ ======
    const wordsAll = [
      
  {"english":"strict","phonetic":"/strÉªkt/","translation_zh":"ä¸¥æ ¼çš„","example_en":"My math teacher is very strict, but she makes sure we understand everything clearly.","example_zh":"æˆ‘çš„æ•°å­¦è€å¸ˆéå¸¸ä¸¥æ ¼ï¼Œä½†å¥¹ç¡®ä¿æˆ‘ä»¬æŠŠå†…å®¹ç†è§£æ¸…æ¥šã€‚"},
  {"english":"patient","phonetic":"/ËˆpeÉªÊƒÉ™nt/","translation_zh":"è€å¿ƒçš„","example_en":"Our English teacher is very patient, and he explains grammar again and again if we donâ€™t get it.","example_zh":"æˆ‘ä»¬çš„è‹±è¯­è€å¸ˆå¾ˆæœ‰è€å¿ƒï¼Œå¦‚æœæˆ‘ä»¬æ²¡ç†è§£ï¼Œä»–ä¼šä¸€å†è®²è§£è¯­æ³•ã€‚"},
  {"english":"encouraging","phonetic":"/ÉªnËˆkÉœËrÉªdÊ’ÉªÅ‹/","translation_zh":"é¼“åŠ±çš„","example_en":"She is always encouraging, so students feel more confident to speak in class.","example_zh":"å¥¹æ€»æ˜¯å¾ˆé¼“åŠ±äººï¼Œæ‰€ä»¥å­¦ç”Ÿåœ¨è¯¾å ‚ä¸Šæ›´æœ‰ä¿¡å¿ƒå‘è¨€ã€‚"},
  {"english":"humorous","phonetic":"/ËˆhjuËmÉ™rÉ™s/","translation_zh":"å¹½é»˜çš„","example_en":"My history teacher is humorous, and he often tells jokes to make the lessons interesting.","example_zh":"æˆ‘çš„å†å²è€å¸ˆå¾ˆå¹½é»˜ï¼Œä»–ç»å¸¸è®²ç¬‘è¯è®©è¯¾å ‚æ›´æœ‰è¶£ã€‚"},
  {"english":"demanding","phonetic":"/dÉªËˆmÃ¦ndÉªÅ‹/","translation_zh":"è¦æ±‚é«˜çš„","example_en":"The chemistry course is quite demanding, and we need to spend many hours on assignments.","example_zh":"åŒ–å­¦è¯¾ç¨‹è¦æ±‚å¾ˆé«˜ï¼Œæˆ‘ä»¬éœ€è¦èŠ±å¾ˆå¤šæ—¶é—´åšä½œä¸šã€‚"},
  {"english":"friendly","phonetic":"/ËˆfrÉ›ndli/","translation_zh":"å‹å¥½çš„","example_en":"Our librarian is very friendly and always helps us find the right books.","example_zh":"æˆ‘ä»¬çš„å›¾ä¹¦ç®¡ç†å‘˜éå¸¸å‹å¥½ï¼Œæ€»æ˜¯å¸®æˆ‘ä»¬æ‰¾åˆ°åˆé€‚çš„ä¹¦ã€‚"},
  {"english":"helpful","phonetic":"/ËˆhÉ›lpfÉ™l/","translation_zh":"ä¹äºåŠ©äººçš„","example_en":"My classmates are very helpful, especially when I have questions about math homework.","example_zh":"æˆ‘çš„åŒå­¦å¾ˆä¹äºåŠ©äººï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘æœ‰æ•°å­¦ä½œä¸šé—®é¢˜æ—¶ã€‚"},
  {"english":"old-fashioned","phonetic":"/ËŒoÊŠldËˆfÃ¦ÊƒÉ™nd/","translation_zh":"è€æ´¾çš„","example_en":"Some teachers are a bit old-fashioned and prefer using chalk instead of modern technology.","example_zh":"æœ‰äº›è€å¸ˆæœ‰ç‚¹è€æ´¾ï¼Œæ›´å–œæ¬¢ç”¨ç²‰ç¬”è€Œä¸æ˜¯ç°ä»£ç§‘æŠ€ã€‚"},
  
  {"english":"compulsory","phonetic":"/kÉ™mËˆpÊŒlsÉ™ri/","translation_zh":"å¿…ä¿®çš„","example_en":"In my country, English is a compulsory subject in both primary and secondary school.","example_zh":"åœ¨æˆ‘å›½ï¼Œè‹±è¯­æ˜¯å°å­¦å’Œä¸­å­¦çš„å¿…ä¿®ç§‘ç›®ã€‚"},
  {"english":"optional","phonetic":"/ËˆÉ‘ËpÊƒÉ™nl/","translation_zh":"é€‰ä¿®çš„","example_en":"Art is an optional subject, but many students choose it because itâ€™s creative and relaxing.","example_zh":"ç¾æœ¯æ˜¯é€‰ä¿®è¯¾ï¼Œä½†å¾ˆå¤šå­¦ç”Ÿé€‰æ‹©å®ƒï¼Œå› ä¸ºæœ‰åˆ›æ„åˆæ”¾æ¾ã€‚"},
  {"english":"subjects","phonetic":"/ËˆsÊŒbdÊ’Éªkts/","translation_zh":"ç§‘ç›®","example_en":"My favourite subjects are biology and history, because I enjoy learning about life and the past.","example_zh":"æˆ‘æœ€å–œæ¬¢çš„ç§‘ç›®æ˜¯ç”Ÿç‰©å’Œå†å²ï¼Œå› ä¸ºæˆ‘å–œæ¬¢å­¦ä¹ ç”Ÿå‘½å’Œè¿‡å»ã€‚"},
  {"english":"assignments","phonetic":"/É™ËˆsaÉªnmÉ™nts/","translation_zh":"ä½œä¸š","example_en":"We have to finish several assignments every week, which can be stressful sometimes.","example_zh":"æˆ‘ä»¬æ¯å‘¨å¿…é¡»å®Œæˆå‡ ä»½ä½œä¸šï¼Œæœ‰æ—¶ä¼šå¾ˆæœ‰å‹åŠ›ã€‚"},
  {"english":"exams","phonetic":"/ÉªÉ¡ËˆzÃ¦mz/","translation_zh":"è€ƒè¯•","example_en":"Final exams are very important, so most students study hard for weeks in advance.","example_zh":"æœŸæœ«è€ƒè¯•å¾ˆé‡è¦ï¼Œæ‰€ä»¥å¤§å¤šæ•°å­¦ç”Ÿæå‰å‡ å‘¨åŠªåŠ›å¤ä¹ ã€‚"},
  {"english":"marks","phonetic":"/mÉ‘Ërks/","translation_zh":"åˆ†æ•°","example_en":"I always feel nervous when I get my exam marks back.","example_zh":"å½“æˆ‘æ‹¿å›è€ƒè¯•åˆ†æ•°æ—¶ï¼Œæˆ‘æ€»æ˜¯å¾ˆç´§å¼ ã€‚"},
  {"english":"major","phonetic":"/ËˆmeÉªdÊ’É™r/","translation_zh":"ä¸“ä¸š","example_en":"At university, I plan to major in education because I want to be a teacher.","example_zh":"åœ¨å¤§å­¦é‡Œï¼Œæˆ‘æ‰“ç®—ä¸»ä¿®æ•™è‚²ï¼Œå› ä¸ºæˆ‘æƒ³å½“è€å¸ˆã€‚"},
  {"english":"history","phonetic":"/ËˆhÉªstÉ™ri/","translation_zh":"å†å²","example_en":"History is fascinating to me because I can learn about different cultures and events.","example_zh":"å†å²è®©æˆ‘ç€è¿·ï¼Œå› ä¸ºæˆ‘èƒ½å­¦ä¹ ä¸åŒçš„æ–‡åŒ–å’Œäº‹ä»¶ã€‚"},
  {"english":"biology","phonetic":"/baÉªËˆÉ‘ËlÉ™dÊ’i/","translation_zh":"ç”Ÿç‰©å­¦","example_en":"Biology is one of my favourite subjects, especially when we study animals and plants.","example_zh":"ç”Ÿç‰©å­¦æ˜¯æˆ‘æœ€å–œæ¬¢çš„ç§‘ç›®ä¹‹ä¸€ï¼Œç‰¹åˆ«æ˜¯å­¦ä¹ åŠ¨ç‰©å’Œæ¤ç‰©æ—¶ã€‚"},
  {"english":"chemistry","phonetic":"/ËˆkÉ›mÉªstri/","translation_zh":"åŒ–å­¦","example_en":"Chemistry is quite challenging, but doing experiments in the laboratory is exciting.","example_zh":"åŒ–å­¦ç›¸å½“æœ‰æŒ‘æˆ˜æ€§ï¼Œä½†åœ¨å®éªŒå®¤é‡Œåšå®éªŒå¾ˆä»¤äººå…´å¥‹ã€‚"},
  {"english":"math","phonetic":"/mÃ¦Î¸/","translation_zh":"æ•°å­¦","example_en":"Math is essential because it trains us to think logically and solve problems.","example_zh":"æ•°å­¦å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒè®­ç»ƒæˆ‘ä»¬é€»è¾‘æ€ç»´å’Œè§£å†³é—®é¢˜ã€‚"},
  {"english":"physics","phonetic":"/ËˆfÉªzÉªks/","translation_zh":"ç‰©ç†å­¦","example_en":"Physics helps me understand how the world works, like why planes can fly.","example_zh":"ç‰©ç†å­¦å¸®åŠ©æˆ‘ç†è§£ä¸–ç•Œå¦‚ä½•è¿ä½œï¼Œæ¯”å¦‚ä¸ºä»€ä¹ˆé£æœºèƒ½é£ã€‚"},
  
  {"english":"discipline","phonetic":"/ËˆdÉªsÉ™plÉªn/","translation_zh":"çºªå¾‹","example_en":"Good discipline in class helps students stay focused and learn better.","example_zh":"è¯¾å ‚ä¸Šçš„è‰¯å¥½çºªå¾‹æœ‰åŠ©äºå­¦ç”Ÿä¿æŒä¸“æ³¨ï¼Œæ›´å¥½åœ°å­¦ä¹ ã€‚"},
  {"english":"private","phonetic":"/ËˆpraÉªvÉ™t/","translation_zh":"ç§ç«‹çš„","example_en":"Private schools usually have smaller classes and more facilities.","example_zh":"ç§ç«‹å­¦æ ¡é€šå¸¸ç­çº§æ›´å°ï¼Œè®¾æ–½æ›´å¤šã€‚"},
  {"english":"public","phonetic":"/ËˆpÊŒblÉªk/","translation_zh":"å…¬ç«‹çš„","example_en":"I studied in a public school, which was free but still provided a good education.","example_zh":"æˆ‘åœ¨å…¬ç«‹å­¦æ ¡å­¦ä¹ ï¼Œè™½ç„¶å…è´¹ï¼Œä½†ä¾ç„¶æä¾›äº†è‰¯å¥½çš„æ•™è‚²ã€‚"},
  {"english":"primary","phonetic":"/ËˆpraÉªmeri/","translation_zh":"å°å­¦çš„","example_en":"I still remember my primary school teachers because they were very caring.","example_zh":"æˆ‘ä»è®°å¾—æˆ‘çš„å°å­¦è€å¸ˆï¼Œå› ä¸ºä»–ä»¬éå¸¸å…³å¿ƒæˆ‘ä»¬ã€‚"},
  {"english":"secondary","phonetic":"/ËˆsÉ›kÉ™ndÉ›ri/","translation_zh":"ä¸­å­¦çš„","example_en":"Secondary school was a turning point in my life as I started to think about my future.","example_zh":"ä¸­å­¦æ˜¯æˆ‘äººç”Ÿçš„è½¬æŠ˜ç‚¹ï¼Œå› ä¸ºæˆ‘å¼€å§‹æ€è€ƒæœªæ¥ã€‚"},
  {"english":"junior","phonetic":"/ËˆdÊ’uËniÉ™r/","translation_zh":"åˆçº§çš„","example_en":"In junior secondary school, I joined many clubs to make new friends.","example_zh":"åœ¨åˆä¸­æ—¶ï¼Œæˆ‘å‚åŠ äº†è®¸å¤šç¤¾å›¢æ¥ç»“äº¤æ–°æœ‹å‹ã€‚"},
  {"english":"senior","phonetic":"/ËˆsiËniÉ™r/","translation_zh":"é«˜å¹´çº§çš„","example_en":"During senior secondary school, students usually prepare for university entrance exams.","example_zh":"åœ¨é«˜ä¸­é˜¶æ®µï¼Œå­¦ç”Ÿé€šå¸¸å‡†å¤‡å¤§å­¦å…¥å­¦è€ƒè¯•ã€‚"},
  {"english":"uniform","phonetic":"/ËˆjuËnÉªfÉ”Ërm/","translation_zh":"æ ¡æœ","example_en":"We had to wear a school uniform every day, which made everyone look the same.","example_zh":"æˆ‘ä»¬æ¯å¤©å¿…é¡»ç©¿æ ¡æœï¼Œè¿™è®©å¤§å®¶çœ‹èµ·æ¥éƒ½ä¸€æ ·ã€‚"},
  {"english":"library","phonetic":"/ËˆlaÉªbreri/","translation_zh":"å›¾ä¹¦é¦†","example_en":"The school library was my favourite place because it was quiet and full of books.","example_zh":"å­¦æ ¡çš„å›¾ä¹¦é¦†æ˜¯æˆ‘æœ€å–œæ¬¢çš„åœ°æ–¹ï¼Œå› ä¸ºé‚£é‡Œå®‰é™è€Œä¸”æœ‰å¾ˆå¤šä¹¦ã€‚"},
  {"english":"laboratory","phonetic":"/lÉ™ËˆbÉ’rÉ™tÉ”Ëri/","translation_zh":"å®éªŒå®¤","example_en":"We often did experiments in the laboratory, which made science lessons more practical.","example_zh":"æˆ‘ä»¬ç»å¸¸åœ¨å®éªŒå®¤é‡Œåšå®éªŒï¼Œè¿™è®©ç§‘å­¦è¯¾æ›´æœ‰å®è·µæ€§ã€‚"}

    ];

    // === Deck helpers (dynamic) ===
    const words = wordsAll;
    function getAllIndices() { return words.map((_, i) => i); }
    function totalTerms() { return words.length; }

    // App state
    let INITIAL_INDICES = getAllIndices();
    let currentIndices = [...INITIAL_INDICES];
    let practiceIndices = [];
    let index = 0;
    let practiceMode = false;
    const startedAt = Date.now();

    // Track first decision per card
    const firstDecision = new Map(); // index -> 'know' | 'practice'

    // ===== DOM =====
    const cardEl = document.getElementById('card');
    const frontWordEl = document.getElementById('frontWord');
    const frontPhonEl = document.getElementById('frontPhon');
    const backTransZhEl = document.getElementById('backTransZh');
    const exEnEl = document.getElementById('exEn');
    const exZhEl = document.getElementById('exZh');
    const audioFrontEl = document.getElementById('audioFront');
    const audioBackEl = document.getElementById('audioBack');
    const congratsEl = document.getElementById('congratsMsg');
    const reviewControlsEl = document.getElementById('reviewControls');
    const congratsSummaryEl = document.getElementById('congratsSummary');
    const siteTitleEl = document.getElementById('siteTitle');
    const siteInstrEl = document.getElementById('siteInstr');

    // Header
    function refreshHeader() {
      siteTitleEl.innerHTML = `æ•™è‚²éƒ¨ - å‡ºå›½äººå‘˜åŸ¹è®­éƒ¨<br/>ç¬¬1å‘¨ â€¢ è‹±â†’ä¸­ é—ªå¡`;
      siteInstrEl.innerHTML = `ç‚¹å‡»å¡ç‰‡ä»¥ç¿»è½¬ã€‚ç‚¹å‡»éŸ³é¢‘å›¾æ ‡ğŸ”Šå¯æ”¶å¬å•è¯æˆ–å¥å­ã€‚`;
    }
    refreshHeader();

    function showCard() {
      const w = words[currentIndices[index]];
      frontWordEl.textContent = w.english;
      frontPhonEl.textContent = w.phonetic;
      backTransZhEl.textContent = w.translation_zh;
      exEnEl.innerHTML = highlightWord(w.example_en, w.english);
      exZhEl.textContent = w.example_zh;
      cardEl.classList.remove('flipped');
    }

    // Highlighter
    function esc(s) { return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
    function highlightWord(sentence, word) {
      const pattern = new RegExp(`\\b${esc(word)}\\b`, 'gi');
      return sentence.replace(pattern, (m) => `<span class="highlight">${m}</span>`);
    }

    // Flip
    cardEl.addEventListener('click', () => { cardEl.classList.toggle('flipped'); });

    // Audio
    const AUDIO_BASE = 'audio/';
    function slugify(text) { return text.toLowerCase().replace(/[^a-z\s]/g, '').trim().replace(/\s+/g, '_'); }
    function wordAudioName(english){ return slugify(english) + '.mp3'; }
    function sentAudioName(english){ return slugify(english) + '_sen.mp3'; }
    function audioUrl(name) { return AUDIO_BASE + name; }
    function playWord() { const w = words[currentIndices[index]]; new Audio(audioUrl(wordAudioName(w.english))).play().catch(()=>{}); }
    function playSentence() { const w = words[currentIndices[index]]; new Audio(audioUrl(sentAudioName(w.english))).play().catch(()=>{}); }
    audioFrontEl.addEventListener('click', (e) => { e.stopPropagation(); playWord(); });
    audioBackEl.addEventListener('click', (e) => { e.stopPropagation(); playSentence(); });

    // Buttons
    document.getElementById('knowBtn').addEventListener('click', () => { record('know'); nextCard(); });
    document.getElementById('practiceBtn').addEventListener('click', () => { record('practice'); nextCard(); });

    function record(action) {
      const cardIdx = currentIndices[index];
      if (!firstDecision.has(cardIdx)) firstDecision.set(cardIdx, action);
      if (action === 'practice' && !practiceIndices.includes(cardIdx)) practiceIndices.push(cardIdx);
    }

    function nextCard() {
      if (index < currentIndices.length - 1) {
        index++;
        showCard();
      } else {
        // finished current run
        cardEl.classList.add('hidden');
        if (!practiceMode && practiceIndices.length > 0) {
          reviewControlsEl.classList.remove('hidden');
        } else {
          const s = computeSummary();
          const elapsedMs = Date.now() - startedAt;
          congratsSummaryEl.textContent = `æŒæ¡ï¼š${s.known}/${s.total} â€¢ éœ€ç»ƒä¹ ï¼š${s.practice}/${s.total} â€¢ å¾—åˆ†ï¼š${s.score}% â€¢ ç”¨æ—¶ï¼š${formatDuration(elapsedMs)}`;
          congratsEl.classList.remove('hidden');
          document.body.classList.add('overlay-open'); // prevent card from intercepting clicks
        }
      }
    }

    document.getElementById('reviewPractice').addEventListener('click', () => {
      practiceMode = true;
      currentIndices = [...practiceIndices];
      index = 0;
      reviewControlsEl.classList.add('hidden');
      congratsEl.classList.add('hidden');
      document.body.classList.remove('overlay-open');
      cardEl.classList.remove('hidden');
      showCard();
    });

    document.getElementById('reviewAll').addEventListener('click', () => {
      practiceMode = false;
      INITIAL_INDICES = getAllIndices();
      currentIndices = [...INITIAL_INDICES];
      practiceIndices = [];
      index = 0;
      congratsEl.classList.add('hidden');
      reviewControlsEl.classList.add('hidden');
      document.body.classList.remove('overlay-open');
      cardEl.classList.remove('hidden');
      refreshHeader();
      showCard();
    });

    document.getElementById('prevBtn').addEventListener('click', () => { if (index > 0) { index--; showCard(); } });
    document.getElementById('nextBtn').addEventListener('click', () => nextCard());

    function computeSummary() {
      const total = totalTerms();
      let known = 0;
      getAllIndices().forEach(i => { if (firstDecision.get(i) === 'know') known++; });
      const practice = total - known;
      const score = Math.round((known / Math.max(total,1)) * 100);
      return { known, practice, score, total };
    }

    // ===== æŠ¥å‘Šæ„å»º + ç”¨æ—¶ =====
    function formatDuration(ms) {
      let s = Math.max(0, Math.floor(ms / 1000));
      const h = Math.floor(s / 3600); s -= h * 3600;
      const m = Math.floor(s / 60); s -= m * 60;
      const pad = (n) => String(n).padStart(2, '0');
      return h > 0 ? `${h}:${pad(m)}:${pad(s)}` : `${m}:${pad(s)}`;
    }

    function buildReport() {
      const student = (document.getElementById('studentId').value || '').trim();
      const finishedAt = new Date();
      const started = new Date(startedAt);
      const s = computeSummary();
      const elapsedMs = Date.now() - startedAt;

      const meta = [
        `<div><strong>è¯åº“ï¼š</strong>ç¬¬1å‘¨ â€¢ è‹±â†’ä¸­ï¼ˆå…± ${s.total} ä¸ªè¯æ¡ï¼‰</div>`,
        `<div><strong>å­¦ç”Ÿï¼š</strong> ${student || 'ï¼ˆæœªå¡«å†™ï¼‰'}</div>`,
        `<div><strong>å¼€å§‹æ—¶é—´ï¼š</strong> ${started.toLocaleString()}</div>`,
        `<div><strong>ç»“æŸæ—¶é—´ï¼š</strong> ${finishedAt.toLocaleString()}</div>`
      ].join('');
      document.getElementById('reportMeta').innerHTML = meta;

      const st = document.getElementById('summaryTable');
      st.innerHTML = `
        <tr><th>æ€»è¯æ•°</th><td>${s.total}</td></tr>
        <tr><th>å·²æŒæ¡</th><td>${s.known}</td></tr>
        <tr><th>éœ€è¦ç»ƒä¹ </th><td>${s.practice}</td></tr>
        <tr><th>ç”¨æ—¶</th><td>${formatDuration(elapsedMs)}</td></tr>
        <tr class="score-row"><th>å¾—åˆ†</th><td>${s.score}%</td></tr>
      `;
    }

    // ===== ç›´æ¥ç”¨ Canvas ç»˜åˆ¶ PNGï¼ˆå¯é ï¼Œå…¼å®¹ç§»åŠ¨ç«¯/æ¡Œé¢ï¼‰ =====
    function drawReportToCanvas() {
      const s = computeSummary();
      const student = (document.getElementById('studentId').value || '').trim();
      const finishedAt = new Date();
      const started = new Date(startedAt);
      const elapsedMs = Date.now() - startedAt;

      const W = 900, P = 24, ROW_H = 36;

      const tmp = document.createElement('canvas');
      tmp.width = W; tmp.height = 1200;
      const ctx = tmp.getContext('2d');
      ctx.fillStyle = "#fff"; ctx.fillRect(0,0,tmp.width,tmp.height);

      const titleFont = "bold 24px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
      const h2Font = "600 18px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
      const bodyFont = "14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
      const scoreFont = "bold 18px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";

      function text(t, x, y, font, color="#111827") { ctx.font = font; ctx.fillStyle = color; ctx.fillText(t, x, y); }
      function line(x1,y1,x2,y2, color="#e5e7eb") { ctx.strokeStyle = color; ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke(); }
      function measure(t, font) { ctx.font = font; return ctx.measureText(t).width; }

      let y = P;

      text("å­¦ä¹ è¡¨ç°æŠ¥å‘Š", P, y+24, titleFont); y += 24 + 8;

      const metaLines = [
        `è¯åº“ï¼šç¬¬1å‘¨ â€¢ è‹±â†’ä¸­ï¼ˆå…± ${s.total} ä¸ªè¯æ¡ï¼‰`,
        `å­¦ç”Ÿï¼š${student || 'ï¼ˆæœªå¡«å†™ï¼‰'}`,
        `å¼€å§‹æ—¶é—´ï¼š${started.toLocaleString()}`,
        `ç»“æŸæ—¶é—´ï¼š${finishedAt.toLocaleString()}`
      ];
      metaLines.forEach(l => { text(l, P, y+16, bodyFont, "#374151"); y += 18; });

      y += 12;
      text("æ‘˜è¦", P, y+18, h2Font); y += 18 + 8;

      const rows = [
        ["æ€»è¯æ•°", String(s.total)],
        ["å·²æŒæ¡", String(s.known)],
        ["éœ€è¦ç»ƒä¹ ", String(s.practice)],
        ["ç”¨æ—¶", formatDuration(elapsedMs)],
        ["å¾—åˆ†", `${s.score}%`]
      ];
      const col1w = Math.max(...rows.map(r => measure(r[0], bodyFont))) + 24;
      const tableX = P, tableW = W - P*2, col2x = tableX + col1w;

      // top border
      line(tableX, y, tableX + tableW, y);
      rows.forEach((r, i) => {
        const isScore = i === rows.length - 1;
        const font = isScore ? scoreFont : bodyFont;
        const color = isScore ? "#0f766e" : "#111827";

        line(tableX, y, tableX, y + ROW_H);
        line(col2x, y, col2x, y + ROW_H);
        line(tableX + tableW, y, tableX + tableW, y + ROW_H);

        text(r[0], tableX + 8, y + 23, font, color);
        text(r[1], col2x + 8, y + 23, font, color);

        line(tableX, y + ROW_H, tableX + tableW, y + ROW_H);
        y += ROW_H;
      });

      const H = y + P;
      const out = document.createElement('canvas');
      out.width = W; out.height = H;
      const octx = out.getContext('2d');
      octx.fillStyle = "#fff"; octx.fillRect(0,0,W,H);
      octx.drawImage(tmp, 0, 0);
      return out;
    }

    async function saveReportAsImage() {
      buildReport();
      const canvas = drawReportToCanvas();
      const dataUrl = canvas.toDataURL('image/png');

      try {
        if (navigator.canShare && typeof navigator.canShare === 'function') {
          const res = await fetch(dataUrl);
          const blob = await res.blob();
          const file = new File([blob], 'å­¦ä¹ è¡¨ç°æŠ¥å‘Š.png', { type: 'image/png' });
          if (navigator.canShare({ files: [file] }) && navigator.share) {
            await navigator.share({ files: [file], title: 'å­¦ä¹ è¡¨ç°æŠ¥å‘Š' });
            return;
          }
        }
      } catch (_) { /* ignore and fallback */ }

      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = 'å­¦ä¹ è¡¨ç°æŠ¥å‘Š.png';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      setTimeout(() => {
        if (!document.hidden) {
          const w = window.open(dataUrl, '_blank');
          if (w) w.focus();
        }
      }, 300);
    }

    document.getElementById('saveImgBtn').addEventListener('click', (e) => {
      e.stopPropagation();
      saveReportAsImage();
    });

    // åˆå§‹åŒ–ï¼šè½½å…¥é¦–å¼ 
    showCard();
  </script>

<script>
// Safely move the å¤ä¹ â€œéœ€è¦ç»ƒä¹ â€ button above the arrow nav without touching functionality.
document.addEventListener('DOMContentLoaded', function () {
  try {
    var nav = document.querySelector('.nav');
    var review = document.getElementById('reviewControls');
    if (nav && review && nav.parentNode) {
      nav.parentNode.insertBefore(review, nav);
    }
  } catch (e) {
    console.error('Reorder failed:', e);
  }
});
</script>
</body>
</html>
